<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ğŸƒ í˜¸ë‘ë„¤ ê°€ê³„ë¶€</title>
<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
body{font-family:'Nanum Gothic',sans-serif;background:#A8E6CF;overflow-x:hidden}
::-webkit-scrollbar{display:none}
.app{max-width:820px;margin:0 auto;min-height:100vh;padding-bottom:100px;
  background:linear-gradient(180deg,#A8E6CF 0%,#DCEDC1 15%,#FEFCF3 35%,#FFF8E7 100%);
  position:relative;overflow:hidden}
.header{position:relative;z-index:1;padding:22px 24px 12px}
.title{font-size:24px;font-weight:800;color:#4E342E;margin-bottom:10px}
.month-bar{display:flex;gap:8px;overflow-x:auto;padding-bottom:10px}
.month-btn{padding:8px 16px;border-radius:20px;font-size:13px;font-weight:700;border:1.5px solid #E8DFC8;
  background:#FFF8E7;color:#795548;white-space:nowrap;cursor:pointer;transition:0.2s;font-family:'Nanum Gothic',sans-serif}
.month-btn.active{background:#43AA8B;color:#fff;border-color:#43AA8B;box-shadow:0 4px 10px rgba(67,170,139,0.3)}
.content{padding:0 24px;animation:fadeIn 0.5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.card{background:#FEFCF3;border-radius:22px;padding:22px;margin-bottom:16px;border:2px solid #E8DFC8;box-shadow:0 4px 10px rgba(0,0,0,0.03)}
.card-title{font-size:16px;font-weight:800;color:#5D4037;margin-bottom:16px}
.stat-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.stat-box{background:#fff;border-radius:16px;padding:14px;text-align:center;border:1px solid #F0E8D0}
.stat-label{font-size:11px;font-weight:700;color:#A1887F;margin-bottom:4px}
.stat-value{font-size:16px;font-weight:800;color:#4E342E}
.income-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px dashed #C8E6C9;
  font-size:14px;font-family:'Nanum Gothic',sans-serif;color:#5D4037;font-weight:600}
.income-row:last-child{border-bottom:none;font-weight:800;color:#2E7D32;padding-top:12px;margin-top:4px;border-top:2px solid #A5D6A7}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;text-align:center}
.cal-day-name{font-size:11px;color:#A1887F;font-weight:700;padding-bottom:8px}
.cal-cell{aspect-ratio:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
  padding-top:6px;border-radius:10px;font-size:12px;font-weight:600;color:#5D4037;position:relative}
.cal-cell.today{background:#43AA8B22;border:1.5px solid #43AA8B}
.cal-cell.payday::after{content:"ğŸ’°";font-size:10px;position:absolute;bottom:4px}
.cal-dot{width:4px;height:4px;border-radius:50%;margin-top:2px}
.rank-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px dashed #E8DFC8}
.rank-row:last-child{border-bottom:none}
.rank-bar-bg{flex:1;height:8px;background:#F0E8D0;border-radius:4px;margin:0 12px;overflow:hidden}
.rank-bar-fill{height:100%;border-radius:4px}
.budget-row{margin-bottom:16px}
.budget-header{display:flex;justify-content:space-between;margin-bottom:6px;font-size:13px;font-weight:700;color:#5D4037}
.budget-track{height:14px;background:#E8DFC8;border-radius:7px;overflow:hidden}
.budget-fill{height:100%;transition:width 0.6s cubic-bezier(0.4,0,0.2,1)}
.tab-bar{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);width:90%;max-width:400px;
  background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);padding:10px 20px;border-radius:30px;
  display:flex;justify-content:space-between;box-shadow:0 8px 30px rgba(0,0,0,0.1);border:1px solid #fff;z-index:100}
.tab-btn{border:none;background:none;display:flex;flex-direction:column;align-items:center;gap:3px;
  cursor:pointer;opacity:0.5;transition:0.2s;font-family:'Nanum Gothic',sans-serif}
.tab-btn.active{opacity:1;transform:scale(1.1)}
.tab-icon{font-size:22px}
.tab-label{font-size:10px;font-weight:700;color:#5D4037}
.loading{padding:60px;text-align:center;color:#795548;font-weight:bold}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="title">ğŸƒ í˜¸ë‘ë„¤ ê°€ê³„ë¶€</div>
    <div class="month-bar" id="month-bar"></div>
  </div>
  <div class="content" id="content"></div>
</div>
<div class="tab-bar">
  <button class="tab-btn active" onclick="setTab('home')"><span class="tab-icon">ğŸ </span><span class="tab-label">í™ˆ</span></button>
  <button class="tab-btn" onclick="setTab('budget')"><span class="tab-icon">ğŸ“Š</span><span class="tab-label">ì˜ˆì‚°</span></button>
  <button class="tab-btn" onclick="setTab('history')"><span class="tab-icon">ğŸ“‹</span><span class="tab-label">ë‚´ì—­</span></button>
  <button class="tab-btn" onclick="setTab('savings')"><span class="tab-icon">ğŸï¸</span><span class="tab-label">ì €ì¶•</span></button>
</div>
<script>
const API_URL="https://script.google.com/macros/s/AKfycbw8SrJhYJwMG0Z7dnxEVEktv33WebDGsP8o5ZJxIbanwaJss75iyrgKlHT1193sYFwm/exec";
const MONTHS=["01","02","03","04","05","06","07","08","09","10","11","12"];
const CAT_MAP={"Groceries":"ğŸ ì‹ë£Œí’ˆ","Dining":"ğŸ½ï¸ ì™¸ì‹","Pet":"ğŸ± í˜¸ë‘","Bill":"ğŸ“± ê³µê³¼ê¸ˆ","Rent":"ğŸ  ì›”ì„¸",
  "ìƒí•„í’ˆ":"ğŸ§» ìƒí•„í’ˆ","Household":"ğŸ¡ ìƒí•„í’ˆ","Gas":"â›½ ì£¼ìœ ","ë³‘ì›":"ğŸ¥ ë³‘ì›","ìš©ëˆ":"ğŸ’¸ ìš©ëˆ",
  "í˜¸ì½¤ìš©ëˆ":"ğŸ® í˜¸ì½¤ìš©ëˆ","ì‡¼í•‘":"ğŸ›ï¸ ì‡¼í•‘","ë¬¸í™”ìƒí™œ":"ğŸ¬ ë¬¸í™”","ê¸°íƒ€":"ğŸ“¦ ê¸°íƒ€"};
const COLOR_MAP={"Groceries":"#FF6B6B","Dining":"#FFA502","Pet":"#ECCC68","Bill":"#70A1FF","Rent":"#5352ED",
  "ìƒí•„í’ˆ":"#FF7F50","Household":"#FF9F43","Gas":"#3742FA","ë³‘ì›":"#FF4757","ìš©ëˆ":"#2ED573",
  "í˜¸ì½¤ìš©ëˆ":"#706FD3","ì‡¼í•‘":"#E056FD","ë¬¸í™”ìƒí™œ":"#1E90FF","ê¸°íƒ€":"#CED6E0"};
const PAYDAYS=["2026-01-08","2026-01-22","2026-02-05","2026-02-19","2026-03-05","2026-03-19",
  "2026-04-02","2026-04-16","2026-04-30","2026-05-14","2026-05-28","2026-06-11",
  "2026-06-25","2026-07-09","2026-07-23","2026-08-06","2026-08-20","2026-09-03",
  "2026-09-17","2026-10-01","2026-10-15","2026-10-29","2026-11-12","2026-11-26","2026-12-10","2026-12-24"];
const SAV_ICON={"ì²´ì´ìŠ¤ ì²´í‚¹":"ğŸ¦","ì²´ì´ìŠ¤ ì„¸ì´ë¹™":"ğŸ’°","IRA(2025)":"ğŸ“ˆ","IRA(2026)":"ğŸ“Š","Varo":"ğŸ·","Webull":"ğŸ“‰"};

let state={month:String(new Date().getMonth()+1).padStart(2,"0"),tab:"home",
  data:{transactions:[],budget:[],savings:[],savingsTotal:null,wire:[],savingsGoals:[]},loading:true};

async function fetchData(){
  state.loading=true;render();
  try{const r=await fetch(API_URL);state.data=await r.json();}
  catch(e){console.error(e);document.getElementById("content").innerHTML='<div class="loading">âš ï¸ ì—°ê²° ì‹¤íŒ¨ â€” ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”</div>';return;}
  state.loading=false;render();
}
setInterval(fetchData,5*60*1000);

function setTab(t){state.tab=t;document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelector(`.tab-btn[onclick="setTab('${t}')"]`).classList.add('active');render();window.scrollTo(0,0);}
function setMonth(m){state.month=m;render();}
function $(n){return"$"+Number(n).toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:0});}

function render(){
  const content=document.getElementById("content");
  document.getElementById("month-bar").innerHTML=MONTHS.map(m=>
    `<button class="month-btn ${state.month===m?'active':''}" onclick="setMonth('${m}')">${parseInt(m)}ì›”</button>`).join("");
  if(state.loading){content.innerHTML='<div class="loading">ğŸƒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”...</div>';return;}
  const txs=(state.data.transactions||[]).filter(t=>t.m===state.month);

  // â•â•â• í™ˆ â•â•â•
  if(state.tab==="home"){
    const inc=txs.filter(t=>t.t==="ìˆ˜ì…").reduce((a,b)=>a+b.amt,0);
    const exp=txs.filter(t=>t.t==="ì§€ì¶œ").reduce((a,b)=>a+b.amt,0);
    const sav=txs.filter(t=>t.t==="ì €ì¶•").reduce((a,b)=>a+b.amt,0);
    const bal=inc-exp-sav;
    content.innerHTML=`
      <div class="card"><div class="card-title">ğŸ“Š ${parseInt(state.month)}ì›” í˜„í™©</div>
        <div class="stat-grid">
          <div class="stat-box"><div class="stat-label">ìˆ˜ì…</div><div class="stat-value" style="color:#2E7D32">${$(inc)}</div></div>
          <div class="stat-box"><div class="stat-label">ì§€ì¶œ</div><div class="stat-value" style="color:#C62828">${$(exp)}</div></div>
          <div class="stat-box"><div class="stat-label">ì €ì¶•</div><div class="stat-value" style="color:#1565C0">${$(sav)}</div></div>
        </div>
        ${inc>0?`<div style="margin-top:12px;padding:10px;border-radius:12px;text-align:center;font-size:14px;font-weight:700;
          background:${bal>=0?'#E8F5E9':'#FFEBEE'};color:${bal>=0?'#2E7D32':'#C62828'}">${bal>=0?'âœ¨':'âš ï¸'} ì”ì•¡: ${$(bal)}</div>`:''}
      </div>
      <div class="card"><div class="card-title">ğŸ“… ${parseInt(state.month)}ì›” ë‹¬ë ¥</div>${renderCalendar(state.month,txs)}</div>`;
  }

  // â•â•â• ì˜ˆì‚° â•â•â•
  else if(state.tab==="budget"){
    const incomeTxs=txs.filter(t=>t.t==="ìˆ˜ì…");
    const incHomin=incomeTxs.filter(t=>t.cat&&t.cat.includes("í˜¸ë¯¼")).reduce((a,b)=>a+b.amt,0);
    const incSaerom=incomeTxs.filter(t=>t.cat&&t.cat.includes("ìƒˆë¡¬")).reduce((a,b)=>a+b.amt,0);
    const incTotal=incomeTxs.reduce((a,b)=>a+b.amt,0);
    const incOther=incTotal-incHomin-incSaerom;
    const expenses=txs.filter(t=>t.t==="ì§€ì¶œ");
    const sp={};expenses.forEach(t=>{let k=t.cat.replace("ì§€ì¶œ_","").replace("ê³ ì •_","");sp[k]=(sp[k]||0)+t.amt;});
    const fb=(state.data.budget||[]).filter(b=>!["ì›”ê°„ í•©ê³„","ì´í•©","Total"].includes(b.category)&&b.target>0);

    content.innerHTML=`
      <div class="card" style="background:#E8F5E9;border-color:#A5D6A7">
        <div class="card-title" style="color:#2E7D32">ğŸ’µ ì´ë²ˆ ë‹¬ ìˆ˜ì…</div>
        <div class="income-row"><span>ğŸ¥ í˜¸ë¯¼ ì›”ê¸‰</span><span>${$(incHomin)}</span></div>
        <div class="income-row"><span>ğŸ¥ ìƒˆë¡¬ ì›”ê¸‰</span><span>${$(incSaerom)}</span></div>
        ${incOther>0?`<div class="income-row"><span>ğŸ“¦ ê¸°íƒ€ ìˆ˜ì…</span><span>${$(incOther)}</span></div>`:''}
        <div class="income-row"><span>í•©ê³„</span><span>${$(incTotal)}</span></div>
      </div>
      <div class="card"><div class="card-title">ğŸ“‰ ì¹´í…Œê³ ë¦¬ë³„ ì˜ˆì‚°</div>
        ${fb.map(b=>{
          const spent=sp[b.category]||0;
          const pct=b.target>0?Math.min((spent/b.target)*100,100):0;
          const info=CAT_MAP[b.category]||b.category;
          const color=COLOR_MAP[b.category]||"#43AA8B";
          return`<div class="budget-row"><div class="budget-header"><span>${info}</span>
            <span style="color:${spent>b.target?'#C62828':'#5D4037'}">${$(spent)} / ${$(b.target)} ${spent>b.target?'ğŸš¨':''}</span></div>
            <div class="budget-track"><div class="budget-fill" style="width:${pct}%;background:${spent>b.target?'#FF6B6B':color}"></div></div></div>`;
        }).join("")}
      </div>`;
  }

  // â•â•â• ë‚´ì—­ â•â•â•
  else if(state.tab==="history"){
    const expenses=txs.filter(t=>t.t==="ì§€ì¶œ");
    const byCat=groupBy(expenses,t=>t.cat.replace("ì§€ì¶œ_","").replace("ê³ ì •_",""));
    const byCard=groupBy(expenses,t=>t.pay?t.pay.split("_")[1]||"ê¸°íƒ€":"ê¸°íƒ€");
    const byUser=groupBy(expenses,t=>t.pay?t.pay.split("_")[0]||"ê³µë™":"ê³µë™");
    content.innerHTML=`
      <div class="card"><div class="card-title">ğŸ¥§ ì§€ì¶œ ë¹„ìœ¨</div>
        <div style="display:flex;justify-content:center;margin:20px 0">${renderDonutChart(byCat)}</div></div>
      <div class="card"><div class="card-title">ğŸ† í•­ëª©ë³„ ìˆœìœ„</div>${renderRanking(byCat,"cat")}</div>
      <div class="card"><div class="card-title">ğŸ’³ ì¹´ë“œë³„</div>${renderRanking(byCard,"card")}</div>
      <div class="card"><div class="card-title">ğŸ‘¥ ì‚¬ìš©ìë³„</div>${renderRanking(byUser,"user")}</div>`;
  }

  // â•â•â• ì €ì¶• (ì›”ë³„ ì´ ìì‚° í‘œì‹œ) â•â•â•
  else if(state.tab==="savings"){
    const savings=state.data.savings||[];
    const st=state.data.savingsTotal;
    const mk="m"+state.month; // ì„ íƒëœ ì›” í‚¤ (ì˜ˆ: "m01", "m02")
    
    // ì„ íƒëœ ì›”ì˜ ì´ ìì‚° (í•´ë‹¹ ì›” ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ í˜„ì¬ ì”ì•¡)
    const monthTotal=st&&st[mk]?st[mk]:st?st.current:savings.reduce((a,s)=>a+(s.balance||0),0);
    const initial=st?st.initial:savings.reduce((a,s)=>a+(s.initial||0),0);
    const goals=state.data.savingsGoals||[];
    const gMap={};goals.forEach(g=>{gMap[g.name]=g.target;});
    const pct=Math.min((monthTotal/20000)*100,100);
    const wire=state.data.wire||[];
    const lastW=wire.length>0?wire[wire.length-1]:null;
    const diff=monthTotal-initial;
    const mn=parseInt(state.month);

    content.innerHTML=`
      <div style="background:linear-gradient(135deg,#43AA8B,#2A9D8F);border-radius:22px;padding:24px;
        margin-bottom:16px;color:#fff;text-align:center;box-shadow:0 4px 14px rgba(42,157,143,0.3)">
        <div style="font-size:14px;font-weight:700;opacity:0.9">ğŸï¸ ${mn}ì›” ì´ ìì‚°</div>
        <div style="font-size:32px;font-weight:800;margin:6px 0">${$(monthTotal)}</div>
        <div style="font-size:12px;opacity:0.85">ì´ˆê¸° ${$(initial)} â†’ <span style="color:${diff>=0?'#F7DC6F':'#FF8A80'}">${diff>=0?'+':''}${$(diff)}</span></div>
        <div style="font-size:11px;opacity:0.8;margin-top:6px">2026 ëª©í‘œ: $20,000 ğŸ’ª</div>
        <div style="height:8px;border-radius:4px;background:rgba(255,255,255,0.2);margin-top:8px;overflow:hidden">
          <div style="height:100%;border-radius:4px;background:#F7DC6F;width:${pct}%;transition:width .6s ease"></div>
        </div>
        <div style="font-size:10px;opacity:0.8;margin-top:4px">${pct.toFixed(1)}% ë‹¬ì„±</div>
      </div>

      <div class="card"><div class="card-title">ğŸ¦ ${mn}ì›” ê³„ì¢Œë³„ í˜„í™©</div>
        ${savings.map(s=>{
          const icon=SAV_ICON[s.name]||"ğŸ’°";
          const target=gMap[s.name]||0;
          const mVal=s[mk]||0; // í•´ë‹¹ ì›” ì…ê¸ˆ/ì”ì•¡
          const bal=s.balance||0;
          return`<div style="display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px dashed #E8DFC8">
            <div>
              <div style="font-size:14px;font-weight:700;color:#5D4037">${icon} ${s.name}</div>
              <div style="font-size:11px;color:#A1887F;margin-top:2px">ì´ˆê¸°: ${$(s.initial||0)}${target>0?' Â· ëª©í‘œ: '+$(target):''}</div>
            </div>
            <div style="text-align:right">
              <div style="font-size:16px;font-weight:800;color:#5D4037">${mVal>0?$(mVal):$(bal)}</div>
              ${mVal>0&&mVal!==bal?`<div style="font-size:10px;color:#A1887F">í˜„ì¬: ${$(bal)}</div>`:''}
            </div>
          </div>`;
        }).join("")}
      </div>

      ${wire.length>0?`<div class="card"><div class="card-title">ğŸŒ ì™€ì´ì–´ë°”ì¼ë¦¬ ì†¡ê¸ˆ</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <div style="background:#FFF8E7;border-radius:14px;padding:14px;text-align:center;border:1px solid #E8DFC8">
            <div style="font-size:10px;color:#A1887F;font-weight:700">ğŸ‡°ğŸ‡· í•˜ë‚˜ì€í–‰ ì”ì•¡</div>
            <div style="font-size:15px;font-weight:800;color:#5D4037;margin-top:4px">â‚©${(lastW.hana_remaining||0).toLocaleString()}</div>
          </div>
          <div style="background:#FFF8E7;border-radius:14px;padding:14px;text-align:center;border:1px solid #E8DFC8">
            <div style="font-size:10px;color:#A1887F;font-weight:700">ğŸ‡ºğŸ‡¸ ì²´ì´ìŠ¤ ì„¸ì´ë¹™</div>
            <div style="font-size:15px;font-weight:800;color:#5D4037;margin-top:4px">${$(lastW.chase_saving||0)}</div>
          </div>
        </div>
        <div style="margin-top:10px;font-size:11px;color:#A1887F;text-align:center;font-weight:600">ì´ ${wire.length}íšŒ ì†¡ê¸ˆ ì™„ë£Œ âœ…</div>
      </div>`:''}`;
  }
}

function renderCalendar(ms,txs){
  const y=2026,m=parseInt(ms)-1,fd=new Date(y,m,1).getDay(),ld=new Date(y,m+1,0).getDate();
  const td=new Date(),ts2=`${y}-${ms}-${String(td.getDate()).padStart(2,"0")}`;
  let h=`<div class="calendar-grid">`;
  ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "].forEach(d=>h+=`<div class="cal-day-name">${d}</div>`);
  for(let i=0;i<fd;i++)h+=`<div></div>`;
  for(let d=1;d<=ld;d++){
    const ds=`${y}-${ms}-${String(d).padStart(2,"0")}`;
    const ip=PAYDAYS.includes(ds);
    const he=txs.some(t=>t.d===`${ms}-${String(d).padStart(2,"0")}`&&t.t==="ì§€ì¶œ");
    h+=`<div class="cal-cell ${ds===ts2?'today':''} ${ip?'payday':''}"><span>${d}</span>${he?'<div class="cal-dot" style="background:#FF6B6B"></div>':''}</div>`;
  }
  return h+`</div>`;
}
function groupBy(a,fn){const m={};a.forEach(t=>{const k=fn(t);m[k]=(m[k]||0)+t.amt;});return Object.entries(m).sort((a,b)=>b[1]-a[1]);}
function renderRanking(data,type){
  if(!data.length)return'<div style="text-align:center;color:#999;padding:10px">ë‚´ì—­ ì—†ìŒ</div>';
  const mx=data[0][1];
  return data.map(([k,v])=>{let l=k,c="#43AA8B";if(type==="cat"){l=CAT_MAP[k]||k;c=COLOR_MAP[k]||c;}
    return`<div class="rank-row"><div style="width:90px;font-size:13px;color:#5D4037;font-weight:700;overflow:hidden;white-space:nowrap;text-overflow:ellipsis">${l}</div><div class="rank-bar-bg"><div class="rank-bar-fill" style="width:${(v/mx)*100}%;background:${c}"></div></div><div style="width:70px;text-align:right;font-size:13px;font-weight:800">${$(v)}</div></div>`;
  }).join("");
}
function renderDonutChart(data){
  if(!data.length)return"";
  let total=data.reduce((a,b)=>a+b[1],0),cum=0;
  const sz=180,r=75,cx=90,cy=90;
  let cd=data.slice(0,5);const ot=data.slice(5).reduce((a,b)=>a+b[1],0);if(ot>0)cd.push(["ê¸°íƒ€",ot]);
  const paths=cd.map(([k,v])=>{const rt=v/total;if(rt<0.01)return"";
    const s1=cum*Math.PI*2,s2=(cum+rt)*Math.PI*2;cum+=rt;
    const x1=cx+r*Math.cos(s1-Math.PI/2),y1=cy+r*Math.sin(s1-Math.PI/2),
      x2=cx+r*Math.cos(s2-Math.PI/2),y2=cy+r*Math.sin(s2-Math.PI/2);
    return`<path d="M${cx},${cy} L${x1},${y1} A${r},${r} 0 ${rt>0.5?1:0},1 ${x2},${y2} Z" fill="${COLOR_MAP[k]||'#CED6E0'}" stroke="#fff" stroke-width="2"/>`;
  });
  const legend=cd.map(([k,v])=>`<div style="display:flex;align-items:center;gap:6px;font-size:11px;margin-bottom:3px">
    <div style="width:10px;height:10px;border-radius:3px;background:${COLOR_MAP[k]||'#CED6E0'};flex-shrink:0"></div>
    <span style="color:#5D4037;font-weight:600">${CAT_MAP[k]||k}</span>
    <span style="color:#A1887F">${((v/total)*100).toFixed(1)}%</span></div>`).join("");
  return`<div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap;justify-content:center">
    <svg width="${sz}" height="${sz}" viewBox="0 0 ${sz} ${sz}">${paths.join("")}<circle cx="${cx}" cy="${cy}" r="38" fill="#FEFCF3"/>
    <text x="${cx}" y="${cy-4}" text-anchor="middle" font-size="10" font-weight="700" fill="#A1887F">ì´ ì§€ì¶œ</text>
    <text x="${cx}" y="${cy+12}" text-anchor="middle" font-size="14" font-weight="800" fill="#5D4037">${$(total)}</text></svg>
    <div>${legend}</div></div>`;
}
fetchData();
</script>
</body>
</html>
