<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ğŸƒ í˜¸ë‘ë„¤ ê°€ê³„ë¶€</title>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
body{font-family:'Nanum Gothic','Malgun Gothic',sans-serif;background:#A8E6CF;overflow-x:hidden}
::-webkit-scrollbar{display:none}
@keyframes leafFall{0%{transform:translateY(-30px) rotate(0);opacity:0}10%{opacity:.4}90%{opacity:.15}100%{transform:translateY(105vh) rotate(360deg);opacity:0}}
@keyframes slideUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes spin{to{transform:rotate(360deg)}}
.app{max-width:820px;margin:0 auto;min-height:100vh;padding-bottom:90px;
  background:linear-gradient(180deg,#A8E6CF 0%,#DCEDC1 15%,#FEFCF3 35%,#FFF8E7 100%);
  position:relative;overflow:hidden}
.leaves{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
.leaf{position:absolute;top:-30px;opacity:.4}
.header{position:relative;z-index:1;padding:22px 24px 12px}
.header-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.title{font-size:24px;font-weight:800;color:#4E342E}
.greeting{font-size:13px;color:#795548;font-weight:600;margin-bottom:3px}
.sync-btn{border-radius:10px;padding:5px 12px;font-size:11px;cursor:pointer;font-weight:600;
  display:flex;align-items:center;gap:5px;font-family:inherit}
.month-bar{display:flex;gap:6px;overflow-x:auto;padding-bottom:5px}
.month-btn{padding:7px 16px;border-radius:20px;cursor:pointer;font-weight:700;font-size:13px;
  white-space:nowrap;flex-shrink:0;font-family:inherit;transition:all .2s ease;border:1.5px solid #E8DFC8;
  background:#FFF8E7;color:#795548}
.month-btn.active{background:linear-gradient(135deg,#7BC67E,#43AA8B);color:#fff;
  box-shadow:0 2px 8px rgba(67,170,139,0.3);border:none}
.content{position:relative;z-index:1;padding:0 24px}
.card{background:#FEFCF3;border-radius:20px;padding:22px;margin-bottom:16px;border:2px solid #E8DFC8}
.card-title{font-size:16px;font-weight:700;color:#5D4037;margin-bottom:14px}
.summary-card{background:linear-gradient(135deg,#FEFCF3,#FFF8E7);box-shadow:0 3px 10px rgba(0,0,0,0.05)}
.stat-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.stat-box{border-radius:14px;padding:14px;text-align:center}
.stat-label{font-size:12px;font-weight:700}
.stat-value{font-size:20px;font-weight:800;margin-top:4px}
.balance-bar{margin-top:14px;padding:10px 14px;border-radius:12px;text-align:center;font-size:15px;font-weight:700}
.txn-row{display:flex;align-items:center;gap:14px;padding:14px 16px;border-radius:14px;margin-bottom:7px}
.txn-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;
  justify-content:center;font-size:20px;flex-shrink:0}
.txn-info{flex:1;min-width:0}
.txn-desc{font-size:15px;font-weight:700;color:#4E342E;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.txn-sub{font-size:12px;color:#A1887F;margin-top:2px}
.txn-amt{font-weight:800;font-size:16px;flex-shrink:0}
.budget-row{margin-bottom:14px}
.budget-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;font-size:15px;font-weight:600;color:#5D4037}
.budget-track{height:18px;border-radius:9px;background:#F5ECD7;border:2px solid #D4C5A0;overflow:hidden;position:relative}
.budget-fill{height:100%;border-radius:7px;transition:width .8s cubic-bezier(0.4,0,0.2,1);
  box-shadow:inset 0 2px 4px rgba(255,255,255,0.3)}
.budget-pct{position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:11px;font-weight:700;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,0.3)}
.filter-bar{display:flex;gap:8px;overflow-x:auto;margin-bottom:14px;padding-bottom:4px}
.filter-btn{padding:7px 18px;border-radius:18px;cursor:pointer;font-family:inherit;font-weight:700;
  font-size:13px;white-space:nowrap;flex-shrink:0;border:1.5px solid #E8DFC8;background:#FFF8E7;color:#795548}
.filter-btn.active{background:#5D4037;color:#fff;border:none}
.savings-hero{background:linear-gradient(135deg,#43AA8B,#2A9D8F);border-radius:20px;padding:24px;
  margin-bottom:16px;color:#fff;text-align:center;box-shadow:0 4px 14px rgba(42,157,143,0.3)}
.savings-scroll{display:flex;gap:12px;overflow-x:auto;padding-bottom:8px;margin-bottom:16px}
.savings-card{background:linear-gradient(135deg,#FEFCF3,#F0E8D0);border-radius:18px;padding:18px;
  border:2px solid #D4C5A0;min-width:165px;flex:0 0 auto;box-shadow:0 3px 8px rgba(0,0,0,0.08)}
.tab-bar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:820px;
  background:linear-gradient(180deg,transparent,#FEFCF3 8%,#FEFCF3);padding:8px 24px 16px;z-index:10}
.tab-inner{display:flex;justify-content:space-around;background:#FFF8E7;border-radius:22px;
  padding:6px;border:2px solid #E8DFC8;box-shadow:0 -2px 10px rgba(0,0,0,0.05)}
.tab-btn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:8px 20px;
  border:none;cursor:pointer;font-family:inherit;border-radius:16px;transition:all .2s ease;background:transparent}
.tab-btn.active{background:#7BC67E33}
.tab-icon{font-size:24px;transition:filter .2s ease}
.tab-btn:not(.active) .tab-icon{filter:grayscale(.5)}
.tab-label{font-size:12px;font-weight:700;color:#A1887F}
.tab-btn.active .tab-label{color:#2E7D32}
.pay-row{display:flex;justify-content:space-between;padding:10px 14px;border-radius:10px;
  background:#FFF8E7;margin-bottom:5px;border:1px solid #E8DFC8}
.pay-row span{font-size:14px!important}
.chart-bar-wrap{display:flex;align-items:flex-end;gap:8px;height:160px;padding:0 4px}
.chart-col{flex:1;display:flex;flex-direction:column;align-items:center}
.chart-val{font-size:11px;font-weight:700;color:#795548;margin-bottom:4px}
.chart-bar{width:100%;max-width:42px;border-radius:6px 6px 0 0;transition:height .6s cubic-bezier(0.4,0,0.2,1)}
.chart-label{font-size:11px;color:#A1887F;margin-top:4px}
.empty{text-align:center;padding:50px;color:#A1887F;font-size:16px}
.error-banner{background:#FFF3E0;border:1.5px solid #FFB74D;border-radius:12px;padding:10px 16px;
  margin-bottom:10px;font-size:13px;color:#E65100}
.payday-badge{background:#FFF8E7;border-radius:12px;padding:6px 12px;border:1.5px solid #E8DFC8;font-size:13px;color:#795548}
.section-label{font-size:13px;font-weight:700;color:#A1887F;margin-bottom:8px}
.divider{height:1px;background:#E8DFC8;margin:14px 0}
.total-bar{margin-top:16px;padding:14px;border-radius:12px;display:flex;justify-content:space-between;align-items:center}
.total-bar span{font-size:15px!important}
.wire-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.wire-box{background:#FFF8E7;border-radius:14px;padding:16px;text-align:center;border:1px solid #E8DFC8}
.hidden{display:none}
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:100px 20px;gap:20px}
.loading-icon{font-size:70px;animation:float 2s ease-in-out infinite}

/* â”€â”€ 2ì—´ ë ˆì´ì•„ì›ƒ (íƒœë¸”ë¦¿) â”€â”€ */
.home-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.home-grid .full-width{grid-column:1/-1}
@media(max-width:600px){
  .app{max-width:100%}
  .home-grid{grid-template-columns:1fr}
  .header{padding:18px 16px 10px}
  .content{padding:0 14px}
  .title{font-size:19px}
  .greeting{font-size:10px}
  .month-btn{padding:5px 11px;font-size:11px}
  .card{padding:16px;border-radius:18px;margin-bottom:12px}
  .card-title{font-size:13px}
  .stat-grid{gap:8px}
  .stat-box{padding:9px}
  .stat-label{font-size:9px}
  .stat-value{font-size:15px}
  .balance-bar{font-size:12px;padding:7px 10px}
  .txn-row{gap:10px;padding:10px 12px}
  .txn-icon{width:34px;height:34px;font-size:17px}
  .txn-desc{font-size:12px}
  .txn-sub{font-size:10px}
  .txn-amt{font-size:13px}
  .budget-header{font-size:13px}
  .budget-track{height:14px}
  .budget-pct{font-size:9px}
  .filter-btn{padding:4px 11px;font-size:10px}
  .tab-bar{padding:6px 14px 14px}
  .tab-btn{padding:5px 11px}
  .tab-icon{font-size:18px}
  .tab-label{font-size:9px}
  .chart-bar-wrap{height:110px}
  .chart-val{font-size:8px}
  .chart-label{font-size:8px}
  .chart-bar{max-width:30px}
  .savings-card{min-width:135px;padding:14px}
  .pay-row span{font-size:11px!important}
  .total-bar span{font-size:12px!important}
  .sync-btn{font-size:9px;padding:3px 8px}
  .payday-badge{font-size:10px;padding:4px 9px}
}
</style>
</head>
<body>

<div class="app" id="app">
  <!-- Leaves -->
  <div class="leaves" id="leaves"></div>

  <!-- Header -->
  <div class="header">
    <div class="header-row">
      <div>
        <div class="greeting" id="greeting"></div>
        <div class="title">ğŸƒ í˜¸ë‘ë„¤ ê°€ê³„ë¶€</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
        <div class="payday-badge" id="payday-badge" style="display:none"></div>
        <button class="sync-btn" id="sync-btn" onclick="fetchData()"></button>
      </div>
    </div>
    <div id="error-banner" class="error-banner hidden">âš ï¸ ì—°ê²° ì‹¤íŒ¨ â€” ì˜¤í”„ë¼ì¸ ëª¨ë“œ</div>
    <div class="month-bar" id="month-bar"></div>
  </div>

  <!-- Content -->
  <div class="content" id="content"></div>

  <!-- Tab Bar -->
  <div class="tab-bar">
    <div class="tab-inner" id="tab-bar"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const API_URL = "https://script.google.com/macros/s/AKfycbxar7X9K0bcG7T4Ll0x5CT8U7VwYLD-YT0Cmc2Qy7FqWKKDreN8wciEJlAEBGfplky2/exec";

const MONTHS = ["01","02","03","04","05","06","07","08","09","10","11","12"];
const MONTH_NAMES = ["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"];
const CAT_MAP = {
  "ì§€ì¶œ_Groceries":{label:"ì‹ë£Œí’ˆ",color:"#7BC67E",icon:"ğŸ"},
  "ì§€ì¶œ_Dining":{label:"ì™¸ì‹",color:"#F4A261",icon:"ğŸ½ï¸"},
  "ì§€ì¶œ_Pet":{label:"í˜¸ë‘(Pet)",color:"#E9C46A",icon:"ğŸ±"},
  "ê³ ì •_Bill":{label:"ê³µê³¼ê¸ˆ",color:"#264653",icon:"ğŸ“±"},
  "ê³ ì •_Rent":{label:"ë ŒíŠ¸",color:"#2A9D8F",icon:"ğŸ "},
  "ì§€ì¶œ_Household":{label:"ìƒí•„í’ˆ",color:"#E76F51",icon:"ğŸ¡"},
  "ì§€ì¶œ_Gas":{label:"ì£¼ìœ /êµí†µ",color:"#606C38",icon:"â›½"},
  "ë³‘ì›":{label:"ë³‘ì›",color:"#BC6C25",icon:"ğŸ¥"},
  "ìš©ëˆ":{label:"ìš©ëˆ",color:"#DDA15E",icon:"ğŸ’¸"},
  "í˜¸ì½¤ìš©ëˆ":{label:"í˜¸ì½¤ìš©ëˆ",color:"#B8860B",icon:"ğŸ®"},
  "ì‡¼í•‘":{label:"ì‡¼í•‘",color:"#CDB4DB",icon:"ğŸ›ï¸"},
  "ë¬¸í™”ìƒí™œ":{label:"ë¬¸í™”ìƒí™œ",color:"#A2D2FF",icon:"ğŸ¬"},
  "ê¸°íƒ€":{label:"ê¸°íƒ€",color:"#BDE0FE",icon:"ğŸ“¦"},
  "ìˆ˜ì…_ìƒˆë¡¬":{label:"ìˆ˜ì…(ìƒˆë¡¬)",color:"#90BE6D",icon:"ğŸ’µ"},
  "ì €ì¶•_ìƒˆë¡¬_varo":{label:"ì €ì¶•(Varo)",color:"#43AA8B",icon:"ğŸ·"},
  "ì €ì¶•_ìƒˆë¡¬_IRA":{label:"ì €ì¶•(IRA)",color:"#577590",icon:"ğŸ“Š"},
};
const SAVINGS_ICONS={"ì²´ì´ìŠ¤ ì²´í‚¹":"ğŸ¦","ì²´ì´ìŠ¤ ì„¸ì´ë¹™":"ğŸ’°","IRA(2025)":"ğŸ“ˆ","IRA(2026)":"ğŸ“Š","Varo":"ğŸ·","Webull":"ğŸ“‰"};
const BUDGET_CAT_MAP={"ì§€ì¶œ_Groceries":"Groceries","ì§€ì¶œ_Dining":"Dining","ì§€ì¶œ_Pet":"Pet",
  "ê³ ì •_Bill":"Bill","ê³ ì •_Rent":"Rent","ì§€ì¶œ_Household":"ìƒí•„í’ˆ","ì§€ì¶œ_Gas":"Gas",
  "ë³‘ì›":"ë³‘ì›","ìš©ëˆ":"ìš©ëˆ","ì‡¼í•‘":"ì‡¼í•‘","ë¬¸í™”ìƒí™œ":"ë¬¸í™”ìƒí™œ"};
const FIXED_CATS=["Rent","Bill","Groceries","Dining","Pet","ìƒí•„í’ˆ","Gas"];
const FLEX_CATS=["ë³‘ì›","ìš©ëˆ","ì‡¼í•‘","ë¬¸í™”ìƒí™œ"];

function getCat(c){return CAT_MAP[c]||{label:c,color:"#999",icon:"ğŸ“Œ"};}
function $(amt,d=0){return"$"+Number(amt).toLocaleString("en-US",{minimumFractionDigits:d,maximumFractionDigits:d});}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let state = {
  month: String(new Date().getMonth()+1).padStart(2,"0"),
  tab: "home",
  filter: "ì „ì²´",
  loading: true,
  error: null,
  lastSync: null,
  transactions: [],
  budget: [],
  savings: [],
  wire: [],
  paydays: [],
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA FETCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchData(){
  state.loading = true;
  state.error = null;
  renderSyncBtn();
  try{
    const res = await fetch(API_URL);
    if(!res.ok) throw new Error("HTTP "+res.status);
    const data = await res.json();
    if(data.error) throw new Error(data.error);
    if(data.transactions) state.transactions = data.transactions.filter(t=>t.amt&&t.amt!==0);
    if(data.budget) state.budget = data.budget.filter(b=>b.category!=="ì›”ê°„ í•©ê³„"&&b.category!=="ì´í•©"&&b.target>0);
    if(data.savings) state.savings = data.savings;
    if(data.wire) state.wire = data.wire;
    if(data.paydays) state.paydays = data.paydays;
    state.lastSync = new Date();
  }catch(e){
    console.error(e);
    state.error = e.message;
  }finally{
    state.loading = false;
    render();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getMonthTxns(){ return state.transactions.filter(t=>t.m===state.month); }
function getExpenses(){ return getMonthTxns().filter(t=>t.t==="ì§€ì¶œ"); }
function getIncome(){ return getMonthTxns().filter(t=>t.t==="ìˆ˜ì…").reduce((s,t)=>s+t.amt,0); }
function getSavings(){ return getMonthTxns().filter(t=>t.t==="ì €ì¶•").reduce((s,t)=>s+t.amt,0); }
function getExpenseTotal(){ return getExpenses().reduce((s,t)=>s+t.amt,0); }

function getCatBreakdown(){
  const m={};
  getExpenses().forEach(t=>{m[t.cat]=(m[t.cat]||0)+t.amt;});
  return Object.entries(m).map(([cat,value])=>({cat,value,...getCat(cat)})).sort((a,b)=>b.value-a.value);
}

function getFilteredTxns(){
  const txns = getMonthTxns();
  if(state.filter==="ì „ì²´") return txns;
  if(["ì§€ì¶œ","ìˆ˜ì…","ì €ì¶•"].includes(state.filter)) return txns.filter(t=>t.t===state.filter);
  return txns.filter(t=>t.cat===state.filter);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER COMPONENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderLeaves(){
  const el = document.getElementById("leaves");
  const emojis = ["ğŸƒ","ğŸ‚","ğŸŒ¿","âœ¨","ğŸƒ","ğŸ‚","ğŸŒ¿"];
  el.innerHTML = emojis.map((e,i)=>{
    const left=Math.random()*100, delay=Math.random()*8, dur=6+Math.random()*6, size=14+Math.random()*10;
    return `<div class="leaf" style="left:${left}%;font-size:${size}px;animation:leafFall ${dur}s ease-in-out ${delay}s infinite">${e}</div>`;
  }).join("");
}

function renderGreeting(){
  const h=new Date().getHours();
  const g = h<12?"ì¢‹ì€ ì•„ì¹¨ì´ì—ìš” â˜€ï¸":h<18?"ì¢‹ì€ ì˜¤í›„ì˜ˆìš” ğŸŒ¤ï¸":"ì¢‹ì€ ì €ë…ì´ì—ìš” ğŸŒ™";
  document.getElementById("greeting").textContent = g;
}

function renderSyncBtn(){
  const btn = document.getElementById("sync-btn");
  if(state.loading){
    btn.style.background="#FFF8E7";btn.style.border="1.5px solid #E8DFC8";btn.style.color="#795548";
    btn.innerHTML='<span style="animation:spin 1s linear infinite;display:inline-block">ğŸ”„</span> ë¡œë”©...';
  }else if(state.error){
    btn.style.background="#FFEBEE";btn.style.border="1.5px solid #EF9A9A";btn.style.color="#C62828";
    btn.innerHTML='âš ï¸ ì¬ì‹œë„';
  }else{
    btn.style.background="#E8F5E9";btn.style.border="1.5px solid #A5D6A7";btn.style.color="#795548";
    const t=state.lastSync;
    btn.innerHTML=`âœ… ${t?t.getHours()+":"+String(t.getMinutes()).padStart(2,"0"):"ì—°ê²°ë¨"}`;
  }
}

function renderPayday(){
  const el=document.getElementById("payday-badge");
  if(state.paydays.length){
    const td=new Date();
    const cur=`${String(td.getMonth()+1).padStart(2,"0")}-${String(td.getDate()).padStart(2,"0")}`;
    const next=state.paydays.find(p=>p>=cur)||state.paydays[0];
    el.innerHTML=`ğŸ’° ê¸‰ì—¬: <b>${next}</b>`;
    el.style.display="block";
  }
}

function renderMonthBar(){
  document.getElementById("month-bar").innerHTML = MONTHS.map((m,i)=>
    `<button class="month-btn ${state.month===m?"active":""}" onclick="setMonth('${m}')">${MONTH_NAMES[i]}</button>`
  ).join("");
}

function renderTabs(){
  const tabs=[{id:"home",label:"í™ˆ",icon:"ğŸ "},{id:"budget",label:"ì˜ˆì‚°",icon:"ğŸ“Š"},
    {id:"list",label:"ë‚´ì—­",icon:"ğŸ“‹"},{id:"savings",label:"ì €ì¶•",icon:"ğŸï¸"}];
  document.getElementById("tab-bar").innerHTML = tabs.map(t=>
    `<button class="tab-btn ${state.tab===t.id?"active":""}" onclick="setTab('${t.id}')">
      <span class="tab-icon">${t.icon}</span>
      <span class="tab-label">${t.label}</span>
    </button>`
  ).join("");
}

function renderError(){
  document.getElementById("error-banner").classList.toggle("hidden",!state.error);
}

// â”€â”€ Transaction Row â”€â”€
function txnRowHTML(t){
  const info=getCat(t.cat);
  const isIn=t.t==="ìˆ˜ì…",isSv=t.t==="ì €ì¶•";
  const bg=isIn?"#E8F5E9":isSv?"#E3F2FD":"#FEFCF3";
  const bc=isIn?"#A5D6A7":isSv?"#90CAF9":"#E8DFC8";
  const ac=isIn?"#2E7D32":isSv?"#1565C0":"#C62828";
  const prefix=isIn?"+":isSv?"â†’":"-";
  return `<div class="txn-row" style="background:${bg};border:1.5px solid ${bc}">
    <div class="txn-icon" style="background:${info.color}33">${info.icon}</div>
    <div class="txn-info">
      <div class="txn-desc">${t.desc||"(ë‚´ì—­ ì—†ìŒ)"}</div>
      <div class="txn-sub">${info.label}${t.pay?" Â· "+t.pay:""}${t.d?" Â· "+t.d:""}</div>
    </div>
    <div class="txn-amt" style="color:${ac}">${prefix}${$(t.amt,2)}</div>
  </div>`;
}

// â”€â”€ Budget Bar â”€â”€
function budgetBarHTML(label,icon,spent,budget,color){
  const pct=budget>0?Math.min((spent/budget)*100,100):0;
  const over=spent>budget&&budget>0;
  const bc=over?"#E74C3C":color;
  return `<div class="budget-row">
    <div class="budget-header">
      <span>${icon} ${label}</span>
      <span style="color:${over?"#E74C3C":"#795548"};font-size:12px">
        ${$(spent,0)} / ${$(budget,0)}${over?' <span style="font-size:10px">ğŸš¨ì´ˆê³¼</span>':""}
      </span>
    </div>
    <div class="budget-track">
      <div class="budget-fill" style="width:${pct}%;background:linear-gradient(90deg,${bc},${bc}88)"></div>
      ${pct>18?`<span class="budget-pct">${pct.toFixed(0)}%</span>`:""}
    </div>
  </div>`;
}

// â”€â”€ Donut Chart â”€â”€
function donutHTML(segments){
  const total=segments.reduce((s,x)=>s+x.value,0);
  if(!total)return"";
  const isTablet=window.innerWidth>600;
  const size=isTablet?190:150,r=size/2-10,cx=size/2,cy=size/2;
  let cum=-90;
  const arcs=segments.filter(s=>s.value>0).map(seg=>{
    const ang=(seg.value/total)*360;
    const s1=(cum*Math.PI)/180,s2=((cum+ang)*Math.PI)/180;
    const la=ang>180?1:0,ir=r*.55;
    const p=`M ${cx+r*Math.cos(s1)} ${cy+r*Math.sin(s1)} A ${r} ${r} 0 ${la} 1 ${cx+r*Math.cos(s2)} ${cy+r*Math.sin(s2)} L ${cx+ir*Math.cos(s2)} ${cy+ir*Math.sin(s2)} A ${ir} ${ir} 0 ${la} 0 ${cx+ir*Math.cos(s1)} ${cy+ir*Math.sin(s1)} Z`;
    cum+=ang;
    return{...seg,path:p,pct:((seg.value/total)*100).toFixed(1)};
  });
  const legendSize=isTablet?"13px":"10px";
  const dotSize=isTablet?"11px":"9px";
  const legend=arcs.slice(0,8).map(a=>
    `<div style="display:flex;align-items:center;gap:6px;font-size:${legendSize}">
      <div style="width:${dotSize};height:${dotSize};border-radius:3px;background:${a.color};flex-shrink:0"></div>
      <span style="color:#795548;font-weight:600">${a.label}</span>
      <span style="color:#A1887F">${a.pct}%</span>
    </div>`
  ).join("");
  return `<div style="display:flex;align-items:center;gap:14px;flex-wrap:wrap;justify-content:center">
    <svg width="${size}" height="${size}">
      ${arcs.map(a=>`<path d="${a.path}" fill="${a.color}" stroke="#FEFCF3" stroke-width="2"/>`).join("")}
      <text x="${cx}" y="${cy-5}" text-anchor="middle" fill="#5D4037" font-size="10" font-weight="700">ì´ ì§€ì¶œ</text>
      <text x="${cx}" y="${cy+11}" text-anchor="middle" fill="#5D4037" font-size="14" font-weight="800">${$(total,0)}</text>
    </svg>
    <div style="display:flex;flex-direction:column;gap:2px">${legend}</div>
  </div>`;
}

// â”€â”€ Monthly Chart â”€â”€
function monthlyChartHTML(){
  const data=MONTHS.map((m,i)=>({
    label:MONTH_NAMES[i],m,
    value:state.transactions.filter(t=>t.m===m&&t.t==="ì§€ì¶œ").reduce((s,t)=>s+t.amt,0),
  }));
  const max=Math.max(...data.map(d=>d.value),1);
  return `<div class="chart-bar-wrap">${data.map(d=>{
    const h=Math.max((d.value/max)*85,2);
    const active=d.m===state.month;
    const bg=active?"linear-gradient(180deg,#E76F51,#E76F5188)":d.value>0?"linear-gradient(180deg,#7BC67E,#7BC67E88)":"#E8DFC8";
    return `<div class="chart-col">
      <div class="chart-val">${d.value>0?"$"+(d.value/1000).toFixed(1)+"k":""}</div>
      <div class="chart-bar" style="height:${h}px;background:${bg}"></div>
      <div class="chart-label" style="color:${active?"#E76F51":"#A1887F"};font-weight:${active?700:400}">${d.label}</div>
    </div>`;
  }).join("")}</div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PAGE RENDERERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderHome(){
  const inc=getIncome(),exp=getExpenseTotal(),sav=getSavings(),bal=inc-exp-sav;
  const txns=getMonthTxns(),cats=getCatBreakdown();
  const mn=MONTH_NAMES[parseInt(state.month)-1];

  let html = `<div style="animation:slideUp .3s ease">`;

  // Summary (full width)
  html += `<div class="card summary-card">
    <div class="card-title">ğŸ“… ${mn} ìš”ì•½</div>
    <div class="stat-grid">
      <div class="stat-box" style="background:#E8F5E944;border:1px solid #A5D6A744">
        <div class="stat-label" style="color:#2E7D32">ìˆ˜ì… ğŸ’µ</div>
        <div class="stat-value" style="color:#2E7D32">${$(inc,0)}</div>
      </div>
      <div class="stat-box" style="background:#FFEBEE44;border:1px solid #EF535044">
        <div class="stat-label" style="color:#C62828">ì§€ì¶œ ğŸ”¥</div>
        <div class="stat-value" style="color:#C62828">${$(exp,0)}</div>
      </div>
      <div class="stat-box" style="background:#E3F2FD44;border:1px solid #42A5F544">
        <div class="stat-label" style="color:#1565C0">ì €ì¶• ğŸ·</div>
        <div class="stat-value" style="color:#1565C0">${$(sav,0)}</div>
      </div>
    </div>
    ${inc>0?`<div class="balance-bar" style="background:${bal>=0?"#E8F5E9":"#FFEBEE"};color:${bal>=0?"#2E7D32":"#C62828"}">
      ${bal>=0?"âœ¨":"âš ï¸"} ì”ì•¡: ${$(bal,2)}
    </div>`:""}
  </div>`;

  // 2ì—´ ê·¸ë¦¬ë“œ ì‹œì‘ (íƒœë¸”ë¦¿ìš©)
  html += `<div class="home-grid">`;

  // Donut (ì¢Œì¸¡)
  if(cats.length) html += `<div class="card" style="margin-bottom:0"><div class="card-title">ğŸ¥§ ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ</div>${donutHTML(cats)}</div>`;

  // Monthly (ìš°ì¸¡)
  html += `<div class="card" style="margin-bottom:0"><div class="card-title">ğŸ“ˆ ì›”ë³„ ì§€ì¶œ</div>${monthlyChartHTML()}</div>`;

  html += `</div>`; // grid ë

  // Recent (full width)
  html += `<div class="card" style="margin-top:16px"><div class="card-title">ğŸ§¾ ìµœê·¼ ë‚´ì—­</div>`;
  if(!txns.length) html += `<div class="empty"><div style="font-size:44px;margin-bottom:10px">ğŸƒ</div>ì´ ë‹¬ì€ ì•„ì§ ë‚´ì—­ì´ ì—†ì–´ìš”</div>`;
  else{
    html += txns.slice(0,6).map(txnRowHTML).join("");
    if(txns.length>6) html += `<div style="text-align:center;font-size:13px;color:#43AA8B;font-weight:700;cursor:pointer;margin-top:8px;padding:6px" onclick="setTab('list')">ì „ì²´ ${txns.length}ê±´ ë³´ê¸° â†’</div>`;
  }
  html += `</div></div>`;
  return html;
}

function renderBudget(){
  const exp=getExpenses(),expTotal=getExpenseTotal();
  const mn=MONTH_NAMES[parseInt(state.month)-1];
  const sp={};
  exp.forEach(t=>{const k=BUDGET_CAT_MAP[t.cat];if(k)sp[k]=(sp[k]||0)+t.amt;});
  const pm={};
  exp.forEach(t=>{const k=t.pay||"(ë¯¸ì§€ì •)";pm[k]=(pm[k]||0)+t.amt;});

  let html = `<div style="animation:slideUp .3s ease"><div class="home-grid">`;
  html += `<div class="card" style="margin-bottom:0"><div class="card-title">ğŸ·ï¸ ${mn} ì˜ˆì‚° í˜„í™©</div>`;
  html += `<div class="section-label">ğŸ“Œ ê³ ì •ë¹„</div>`;
  state.budget.filter(b=>FIXED_CATS.includes(b.category)).forEach(b=>{
    const info=getCat(Object.entries(BUDGET_CAT_MAP).find(([,v])=>v===b.category)?.[0]||b.category);
    html += budgetBarHTML(b.category,info.icon,sp[b.category]??b.spent,b.target,info.color);
  });
  html += `<div class="divider"></div><div class="section-label">ğŸ¯ ìœ ë™ë¹„</div>`;
  state.budget.filter(b=>FLEX_CATS.includes(b.category)).forEach(b=>{
    const info=getCat(Object.entries(BUDGET_CAT_MAP).find(([,v])=>v===b.category)?.[0]||b.category);
    html += budgetBarHTML(b.category,info.icon,sp[b.category]??b.spent,b.target,info.color);
  });

  const ok=expTotal<=5135;
  html += `<div class="total-bar" style="background:${ok?"#E8F5E9":"#FFEBEE"};border:1px solid ${ok?"#A5D6A7":"#EF9A9A"}">
    <span style="font-size:14px;font-weight:700;color:#5D4037">${ok?"âœ…":"ğŸš¨"} ì´ ì§€ì¶œ</span>
    <span style="font-size:16px;font-weight:800;color:${ok?"#2E7D32":"#C62828"}">${$(expTotal,0)} / $5,135</span>
  </div></div>`;

  // Payment methods (ìš°ì¸¡)
  html += `<div class="card" style="margin-bottom:0"><div class="card-title">ğŸ’³ ê²°ì œìˆ˜ë‹¨ë³„</div>`;
  Object.entries(pm).sort((a,b)=>b[1]-a[1]).forEach(([p,a])=>{
    html += `<div class="pay-row"><span style="font-weight:600;color:#795548">ğŸ’³ ${p}</span>
      <span style="font-weight:800;color:#5D4037">${$(a,2)}</span></div>`;
  });
  html += `</div></div></div>`;
  return html;
}

function renderList(){
  const txns=getFilteredTxns();
  const mn=MONTH_NAMES[parseInt(state.month)-1];
  let html = `<div style="animation:slideUp .3s ease">`;
  html += `<div class="filter-bar">${["ì „ì²´","ì§€ì¶œ","ìˆ˜ì…","ì €ì¶•"].map(f=>
    `<button class="filter-btn ${state.filter===f?"active":""}" onclick="setFilter('${f}')">${f}</button>`
  ).join("")}</div>`;
  html += `<div style="font-size:11px;color:#A1887F;font-weight:600;margin-bottom:6px">${mn} Â· ${txns.length}ê±´</div>`;
  if(!txns.length) html += `<div class="empty"><div style="font-size:44px;margin-bottom:10px">ğŸƒ</div>ë‚´ì—­ì´ ì—†ì–´ìš”</div>`;
  else html += txns.map(txnRowHTML).join("");
  html += `</div>`;
  return html;
}

function renderSavingsTab(){
  const total=state.savings.reduce((s,a)=>s+a.balance,0);
  const pct=Math.min((total/20000)*100,100);

  let html = `<div style="animation:slideUp .3s ease">`;
  html += `<div class="savings-hero">
    <div style="font-size:14px;font-weight:700;opacity:.9;margin-bottom:4px">ğŸï¸ ì´ ìì‚°</div>
    <div style="font-size:32px;font-weight:800;margin-bottom:6px">${$(total,2)}</div>
    <div style="font-size:13px;opacity:.8">2026 ëª©í‘œ: $20,000 ğŸ’ª</div>
    <div style="height:9px;border-radius:5px;background:rgba(255,255,255,.2);margin-top:10px;overflow:hidden">
      <div style="height:100%;border-radius:5px;background:#F7DC6F;width:${pct}%;transition:width .6s ease"></div>
    </div>
    <div style="font-size:11px;opacity:.8;margin-top:4px">${pct.toFixed(1)}% ë‹¬ì„±</div>
  </div>`;

  html += `<div class="savings-scroll">${state.savings.map(a=>{
    const icon=SAVINGS_ICONS[a.name]||"ğŸ’°";
    const hasTgt=a.target>0;
    const p=hasTgt?(a.balance/a.target)*100:0;
    return `<div class="savings-card">
      <div style="font-size:30px;text-align:center;margin-bottom:6px">${icon}</div>
      <div style="font-size:13px;font-weight:700;color:#795548;text-align:center;margin-bottom:4px">${a.name}</div>
      <div style="font-size:18px;font-weight:800;color:#5D4037;text-align:center">${$(a.balance,2)}</div>
      ${hasTgt?`<div style="margin-top:10px">
        <div style="height:9px;border-radius:5px;background:#E8DFC8;overflow:hidden">
          <div style="height:100%;width:${Math.min(p,100)}%;border-radius:5px;background:${p>=100?"#43AA8B":"#F4A261"};transition:width .6s ease"></div>
        </div>
        <div style="font-size:11px;color:#999;text-align:center;margin-top:4px">ëª©í‘œ ${$(a.target,0)} (${p.toFixed(0)}%)</div>
      </div>`:""}
    </div>`;
  }).join("")}</div>`;

  if(state.wire.length){
    const last=state.wire[state.wire.length-1];
    html += `<div class="card"><div class="card-title">ğŸŒ ì™€ì´ì–´ë°”ì¼ë¦¬</div>
      <div class="wire-grid">
        <div class="wire-box"><div style="font-size:9px;color:#A1887F;font-weight:700">ğŸ‡°ğŸ‡· í•˜ë‚˜ì€í–‰</div>
          <div style="font-size:13px;font-weight:800;color:#5D4037;margin-top:3px">â‚©${(last.hana_remaining||0).toLocaleString()}</div></div>
        <div class="wire-box"><div style="font-size:9px;color:#A1887F;font-weight:700">ğŸ‡ºğŸ‡¸ ì²´ì´ìŠ¤</div>
          <div style="font-size:13px;font-weight:800;color:#5D4037;margin-top:3px">${$(last.chase_saving||0,2)}</div></div>
      </div>
      <div style="margin-top:8px;font-size:10px;color:#A1887F;text-align:center;font-weight:600">ì´ ${state.wire.length}íšŒ ì†¡ê¸ˆ âœ…</div>
    </div>`;
  }
  html += `</div>`;
  return html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render(){
  renderSyncBtn();
  renderError();
  renderMonthBar();
  renderTabs();
  renderPayday();

  const content = document.getElementById("content");
  if(state.loading && !state.transactions.length){
    content.innerHTML = `<div class="loading"><div class="loading-icon">ğŸƒ</div>
      <div style="font-size:15px;font-weight:700;color:#5D4037">ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>
      <div style="font-size:11px;color:#A1887F">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div></div>`;
    return;
  }

  switch(state.tab){
    case "home": content.innerHTML = renderHome(); break;
    case "budget": content.innerHTML = renderBudget(); break;
    case "list": content.innerHTML = renderList(); break;
    case "savings": content.innerHTML = renderSavingsTab(); break;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setMonth(m){ state.month=m; render(); }
function setTab(t){ state.tab=t; state.filter="ì „ì²´"; render(); window.scrollTo(0,0); }
function setFilter(f){ state.filter=f; render(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderLeaves();
renderGreeting();
fetchData();
setInterval(fetchData, 5*60*1000); // 5ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
</script>
</body>
</html>
