<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ğŸƒ í˜¸ë‘ë„¤ ê°€ê³„ë¶€</title>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
<style>
/* ì›ë³¸ budget-app.jsxì˜ ìŠ¤íƒ€ì¼ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤ */
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
body{font-family:'Nanum Gothic',sans-serif;background:#A8E6CF;overflow-x:hidden}
::-webkit-scrollbar{display:none}

/* ë‚™ì—½ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes leafFall{0%{transform:translateY(-10px) rotate(0);opacity:0}10%{opacity:0.6}90%{opacity:0.6}100%{transform:translateY(100vh) rotate(360deg);opacity:0}}

.app{max-width:820px;margin:0 auto;min-height:100vh;padding-bottom:90px;
  background:linear-gradient(180deg,#A8E6CF 0%,#DCEDC1 15%,#FEFCF3 35%,#FFF8E7 100%);
  position:relative;overflow:hidden}

.leaves{position:fixed;inset:0;pointer-events:none;z-index:0}
.leaf{position:absolute;top:-30px;opacity:0.6}

.header{position:relative;z-index:1;padding:24px 24px 12px}
.header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.title{font-size:24px;font-weight:800;color:#4E342E}
.greeting{font-size:13px;color:#795548;font-weight:600;margin-bottom:4px}
.sync-btn{background:#E8F5E9;border:1px solid #A5D6A7;color:#2E7D32;border-radius:20px;padding:4px 12px;font-size:11px;font-weight:700;cursor:pointer}

.month-bar{display:flex;gap:8px;overflow-x:auto;padding-bottom:8px}
.month-btn{padding:8px 16px;border-radius:20px;font-size:13px;font-weight:700;border:1.5px solid #E8DFC8;background:#FFF8E7;color:#795548;white-space:nowrap;cursor:pointer}
.month-btn.active{background:linear-gradient(135deg,#7BC67E,#43AA8B);color:#fff;border:none;box-shadow:0 2px 8px rgba(67,170,139,0.3)}

.content{position:relative;z-index:1;padding:0 24px}
.card{background:#FEFCF3;border-radius:20px;padding:24px;margin-bottom:16px;border:2px solid #E8DFC8}
.card-title{font-size:16px;font-weight:700;color:#5D4037;margin-bottom:16px;display:flex;align-items:center;gap:6px}

/* ìš”ì•½ ì¹´ë“œ ê·¸ë¦¬ë“œ */
.stat-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.stat-box{background:rgba(255,255,255,0.5);border:1px solid rgba(0,0,0,0.05);border-radius:16px;padding:16px;text-align:center}
.stat-label{font-size:12px;font-weight:600;color:#795548;margin-bottom:4px}
.stat-val{font-size:18px;font-weight:800;color:#4E342E}

/* ê±°ë˜ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ */
.txn-row{display:flex;align-items:center;gap:12px;padding:12px;background:#FFF8E7;border-radius:12px;margin-bottom:8px}
.txn-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px}
.txn-info{flex:1}
.txn-desc{font-size:14px;font-weight:700;color:#4E342E}
.txn-sub{font-size:11px;color:#A1887F;margin-top:2px}
.txn-amt{font-size:15px;font-weight:800}

/* ì˜ˆì‚° ë§‰ëŒ€ */
.budget-row{margin-bottom:16px}
.budget-head{display:flex;justify-content:space-between;margin-bottom:6px;font-size:14px;font-weight:700;color:#5D4037}
.budget-track{height:16px;background:#E8DFC8;border-radius:8px;overflow:hidden}
.budget-fill{height:100%;border-radius:8px;transition:width 0.5s ease}

/* ì €ì¶• íƒ­ */
.savings-hero{background:linear-gradient(135deg,#43AA8B,#2A9D8F);color:white;padding:24px;border-radius:20px;text-align:center;margin-bottom:16px;box-shadow:0 4px 12px rgba(42,157,143,0.3)}
.savings-item{background:#FFF;border:1px solid #E8DFC8;border-radius:16px;padding:16px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
.wire-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
.wire-box{background:#FFF8E7;border:1px solid #E8DFC8;border-radius:12px;padding:12px;text-align:center}

/* íƒ­ ë°” */
.tab-bar{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);width:calc(100% - 48px);max-width:772px;
  background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);border-radius:24px;padding:12px;
  display:flex;justify-content:space-around;box-shadow:0 4px 20px rgba(0,0,0,0.08);z-index:100;border:1px solid #E8DFC8}
.tab-btn{border:none;background:none;display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;opacity:0.5;transition:all 0.2s}
.tab-btn.active{opacity:1;transform:scale(1.1)}
.tab-icon{font-size:24px}
.tab-label{font-size:10px;font-weight:700;color:#5D4037}

.loading{padding:60px;text-align:center;color:#795548;font-weight:700}
</style>
</head>
<body>

<div class="app" id="app">
  <div class="leaves" id="leaves"></div>
  
  <div class="header">
    <div class="header-top">
      <div>
        <div class="greeting" id="greeting"></div>
        <div class="title">ğŸƒ í˜¸ë‘ë„¤ ê°€ê³„ë¶€</div>
      </div>
      <button class="sync-btn" onclick="fetchData()">ğŸ”„ ë™ê¸°í™”</button>
    </div>
    <div class="month-bar" id="month-bar"></div>
  </div>

  <div class="content" id="content"></div>

  <div class="tab-bar">
    <button class="tab-btn" onclick="setTab('home')"><span class="tab-icon">ğŸ </span><span class="tab-label">í™ˆ</span></button>
    <button class="tab-btn" onclick="setTab('budget')"><span class="tab-icon">ğŸ“Š</span><span class="tab-label">ì˜ˆì‚°</span></button>
    <button class="tab-btn" onclick="setTab('list')"><span class="tab-icon">ğŸ“‹</span><span class="tab-label">ë‚´ì—­</span></button>
    <button class="tab-btn" onclick="setTab('savings')"><span class="tab-icon">ğŸï¸</span><span class="tab-label">ì €ì¶•</span></button>
  </div>
</div>

<script>
// 1. ì›ë³¸ ì„¤ì •ê°’ ë³µì›
const API_URL = "https://script.google.com/macros/s/AKfycbxar7X9K0bcG7T4Ll0x5CT8U7VwYLD-YT0Cmc2Qy7FqWKKDreN8wciEJlAEBGfplky2/exec";
const MONTHS = ["01","02","03","04","05","06","07","08","09","10","11","12"];

// ì›ë³¸ ì½”ë“œì— ìˆë˜ ì¹´í…Œê³ ë¦¬ ë§¤í•‘ (ì´ê²Œ ìˆì–´ì•¼ ì˜ˆì‚°ì´ ì¡í™ë‹ˆë‹¤!)
const CAT_MAP = {
  "ì§€ì¶œ_Groceries": {label:"ì‹ë£Œí’ˆ", icon:"ğŸ", color:"#7BC67E"},
  "ì§€ì¶œ_Dining": {label:"ì™¸ì‹", icon:"ğŸ½ï¸", color:"#F4A261"},
  "ì§€ì¶œ_Pet": {label:"í˜¸ë‘", icon:"ğŸ±", color:"#E9C46A"},
  "ê³ ì •_Bill": {label:"ê³µê³¼ê¸ˆ", icon:"ğŸ“±", color:"#264653"},
  "ê³ ì •_Rent": {label:"ë ŒíŠ¸", icon:"ğŸ ", color:"#2A9D8F"},
  "ì§€ì¶œ_Household": {label:"ìƒí•„í’ˆ", icon:"ğŸ¡", color:"#E76F51"},
  "ì§€ì¶œ_Gas": {label:"ì£¼ìœ ", icon:"â›½", color:"#606C38"},
  "ë³‘ì›": {label:"ë³‘ì›", icon:"ğŸ¥", color:"#BC6C25"},
  "ìš©ëˆ": {label:"ìš©ëˆ", icon:"ğŸ’¸", color:"#DDA15E"},
  "ì‡¼í•‘": {label:"ì‡¼í•‘", icon:"ğŸ›ï¸", color:"#CDB4DB"},
  "ë¬¸í™”ìƒí™œ": {label:"ë¬¸í™”ìƒí™œ", icon:"ğŸ¬", color:"#A2D2FF"},
  "ìˆ˜ì…_ìƒˆë¡¬": {label:"ì›”ê¸‰", icon:"ğŸ’µ", color:"#90BE6D"},
  "ì €ì¶•": {label:"ì €ì¶•", icon:"ğŸ’°", color:"#43AA8B"}
};

// ì˜ˆì‚° ê³„ì‚°ìš© ë§¤í•‘
const BUDGET_CAT_MAP = {
  "ì§€ì¶œ_Groceries": "Groceries", "ì§€ì¶œ_Dining": "Dining", "ì§€ì¶œ_Pet": "Pet",
  "ê³ ì •_Bill": "Bill", "ê³ ì •_Rent": "Rent", "ì§€ì¶œ_Household": "ìƒí•„í’ˆ", "ì§€ì¶œ_Gas": "Gas",
  "ë³‘ì›": "ë³‘ì›", "ìš©ëˆ": "ìš©ëˆ", "ì‡¼í•‘": "ì‡¼í•‘", "ë¬¸í™”ìƒí™œ": "ë¬¸í™”ìƒí™œ"
};

let state = {
  month: String(new Date().getMonth()+1).padStart(2,"0"),
  tab: "home",
  transactions: [],
  budget: [],
  savings: [],
  wire: [],
  loading: true
};

function $(n) { return "$" + Number(n).toLocaleString(); }

// 2. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
async function fetchData() {
  state.loading = true; render();
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    state.transactions = data.transactions || [];
    state.budget = data.budget || [];
    state.savings = data.savings || [];
    state.wire = data.wire || []; // ì™€ì´ì–´ë°”ì¼ë¦¬ ë°ì´í„° ì¶”ê°€
  } catch(e) {
    console.error(e);
  } finally {
    state.loading = false;
    render();
  }
}

function setMonth(m) { state.month = m; render(); }
function setTab(t) { 
  state.tab = t; 
  // íƒ­ ë³€ê²½ ì‹œ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelector(`.tab-btn[onclick="setTab('${t}')"]`).classList.add('active');
  render(); 
  window.scrollTo(0,0); 
}

// 3. í™”ë©´ ê·¸ë¦¬ê¸° (ë Œë”ë§)
function render() {
  const content = document.getElementById("content");
  
  // ì¸ì‚¬ë§ ì„¤ì •
  const hour = new Date().getHours();
  document.getElementById("greeting").innerText = hour < 12 ? "ì¢‹ì€ ì•„ì¹¨ì´ì—ìš” â˜€ï¸" : hour < 18 ? "ì¢‹ì€ ì˜¤í›„ì˜ˆìš” ğŸŒ¤ï¸" : "ì¢‹ì€ ì €ë…ì´ì—ìš” ğŸŒ™";

  // ì›” ë²„íŠ¼ ê·¸ë¦¬ê¸°
  document.getElementById("month-bar").innerHTML = MONTHS.map(m => 
    `<button class="month-btn ${state.month===m?'active':''}" onclick="setMonth('${m}')">${parseInt(m)}ì›”</button>`
  ).join("");

  if(state.loading) {
    content.innerHTML = '<div class="loading">ğŸƒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
    return;
  }

  // íƒ­ë³„ í™”ë©´ êµ¬ì„±
  if (state.tab === "home") {
    const txs = state.transactions.filter(t => t.m === state.month);
    const inc = txs.filter(t => t.t === "ìˆ˜ì…").reduce((s,t) => s + t.amt, 0);
    const exp = txs.filter(t => t.t === "ì§€ì¶œ").reduce((s,t) => s + t.amt, 0);
    const sav = txs.filter(t => t.t === "ì €ì¶•").reduce((s,t) => s + t.amt, 0);

    content.innerHTML = `
      <div class="card">
        <div class="card-title">ğŸ“… ${parseInt(state.month)}ì›” ìš”ì•½</div>
        <div class="stat-grid">
          <div class="stat-box"><div class="stat-label">ìˆ˜ì…</div><div class="stat-val" style="color:#2E7D32">${$(inc)}</div></div>
          <div class="stat-box"><div class="stat-label">ì§€ì¶œ</div><div class="stat-val" style="color:#C62828">${$(exp)}</div></div>
          <div class="stat-box"><div class="stat-label">ì €ì¶•</div><div class="stat-val" style="color:#1565C0">${$(sav)}</div></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ§¾ ìµœê·¼ ë‚´ì—­</div>
        ${txs.length ? txs.slice(0, 5).map(renderTxnRow).join("") : '<div style="text-align:center;color:#999;padding:20px">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>'}
      </div>
    `;

  } else if (state.tab === "budget") {
    // ì˜ˆì‚° ê³„ì‚° (ì›ë³¸ ë¡œì§ ë³µì›)
    const txs = state.transactions.filter(t => t.m === state.month && t.t === "ì§€ì¶œ");
    const spentMap = {};
    txs.forEach(t => {
      const key = BUDGET_CAT_MAP[t.cat] || t.cat;
      spentMap[key] = (spentMap[key] || 0) + t.amt;
    });

    content.innerHTML = `
      <div class="card">
        <div class="card-title">ğŸ“Š ì˜ˆì‚° í˜„í™©</div>
        ${state.budget.length ? state.budget.map(b => {
          const spent = spentMap[b.category] || 0;
          const pct = b.target > 0 ? Math.min((spent / b.target) * 100, 100) : 0;
          const isOver = spent > b.target;
          return `
            <div class="budget-row">
              <div class="budget-head">
                <span>${CAT_MAP[`ì§€ì¶œ_${b.category}`]?.icon || "ğŸ·ï¸"} ${b.category}</span>
                <span style="color:${isOver ? '#C62828' : '#5D4037'}">${$(spent)} / ${$(b.target)}</span>
              </div>
              <div class="budget-track">
                <div class="budget-fill" style="width:${pct}%; background:${isOver ? '#E74C3C' : '#43AA8B'}"></div>
              </div>
            </div>
          `;
        }).join("") : 'ì˜ˆì‚° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'}
      </div>
    `;

  } else if (state.tab === "list") {
    const txs = state.transactions.filter(t => t.m === state.month);
    content.innerHTML = `<div class="card"><div class="card-title">ğŸ“‹ ì „ì²´ ë‚´ì—­</div>${txs.map(renderTxnRow).join("")}</div>`;

  } else if (state.tab === "savings") {
    const total = state.savings.reduce((s, i) => s + i.balance, 0);
    const wire = state.wire[state.wire.length - 1] || {}; // ìµœê·¼ ì†¡ê¸ˆ ë‚´ì—­

    content.innerHTML = `
      <div class="savings-hero">
        <div style="font-size:14px;opacity:0.9">ì´ ìì‚°</div>
        <div style="font-size:32px;font-weight:800;margin-top:8px">${$(total)}</div>
        <div style="margin-top:12px;font-size:13px">2026 ëª©í‘œ: $20,000 ğŸ’ª</div>
      </div>
      <div class="card">
        <div class="card-title">ğŸï¸ ê³„ì¢Œë³„ í˜„í™©</div>
        ${state.savings.map(s => `
          <div class="savings-item">
            <div style="font-weight:700;color:#5D4037">${s.name}</div>
            <div style="font-weight:800;color:#2E7D32">${$(s.balance)}</div>
          </div>
        `).join("")}
      </div>
      <div class="card">
        <div class="card-title">ğŸŒ ì™€ì´ì–´ë°”ì¼ë¦¬</div>
        <div class="wire-grid">
          <div class="wire-box">
            <div style="font-size:11px;color:#A1887F">ğŸ‡°ğŸ‡· í•˜ë‚˜ì€í–‰</div>
            <div style="font-weight:800;color:#5D4037;margin-top:4px">â‚©${(wire.hana_remaining||0).toLocaleString()}</div>
          </div>
          <div class="wire-box">
            <div style="font-size:11px;color:#A1887F">ğŸ‡ºğŸ‡¸ ì²´ì´ìŠ¤</div>
            <div style="font-weight:800;color:#5D4037;margin-top:4px">${$(wire.chase_saving||0)}</div>
          </div>
        </div>
      </div>
    `;
  }
}

function renderTxnRow(t) {
  const meta = CAT_MAP[t.cat] || {label:t.cat, icon:"ğŸ“Œ", color:"#ddd"};
  const color = t.t === "ìˆ˜ì…" ? "#2E7D32" : t.t === "ì§€ì¶œ" ? "#C62828" : "#1565C0";
  const sign = t.t === "ìˆ˜ì…" ? "+" : t.t === "ì§€ì¶œ" ? "-" : "";
  
  return `
    <div class="txn-row">
      <div class="txn-icon" style="background:${meta.color}33">${meta.icon}</div>
      <div class="txn-info">
        <div class="txn-desc">${t.desc}</div>
        <div class="txn-sub">${meta.label} Â· ${t.date?.split("T")[0] || ""}</div>
      </div>
      <div class="txn-amt" style="color:${color}">${sign}${$(t.amt)}</div>
    </div>
  `;
}

// 4. ë‚™ì—½ ì• ë‹ˆë©”ì´ì…˜ ìƒì„±
function initLeaves() {
  const container = document.getElementById("leaves");
  const emojis = ["ğŸƒ", "ğŸ‚", "ğŸŒ¿", "âœ¨"];
  container.innerHTML = Array(10).fill(0).map(() => {
    const left = Math.random() * 100;
    const delay = Math.random() * 5;
    const duration = 8 + Math.random() * 5;
    const emoji = emojis[Math.floor(Math.random() * emojis.length)];
    return `<div class="leaf" style="left:${left}%;animation:leafFall ${duration}s linear ${delay}s infinite;font-size:${14+Math.random()*10}px">${emoji}</div>`;
  }).join("");
}

// ì´ˆê¸°í™” ì‹¤í–‰
initLeaves();
fetchData();
document.querySelector('.tab-btn').classList.add('active'); // ì²« íƒ­ í™œì„±í™”

// ğŸµ BGM ì¬ìƒ
const bgm = new Audio('bgm.mp3');
bgm.loop = true;
document.addEventListener('click', () => { if(bgm.paused) bgm.play(); }, { once: true });
</script>
</body>
</html>
